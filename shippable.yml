language: node_js

node_js:
 - 0.10
 - 0.8
  
matrix:
  exclude:
    - node_js: 0.8


# For xunit-file module to put results in shippable folder
env:
 global:
  - XUNIT_FILE=shippable/testresults/result.xml
  - secure: kQZBXrsy2tW1Tm5uIdFBLNugfXUrT/I37bEOQuyT+nnD/yo1RLUWkEt/fUl7Wr6UiFIVk7OwMW4V3q+4zjZ1vhrBV1o0kE9L0riY1HDqWK76lEooFby5csfJci7Ps55idWkQnNx3UYtXNWIiS6qBqtq+b0B4F5d0r/DtvJqSftaK8EgcoaVhb0jmIEukfkKvTemX40NgDgAZV4dHeFbXP9nePTF2OAwxPotuQTtTKfmI3fClUKkmpd0ND9s8uiRaoD+5sByhfMrqsUBi8ufWOzLgi7F7sryDhdFPf7nZ2b60zm8EECLcqDnBp+G4xLMOqq8nvL3M5bKY+8njfVq4XQ==
  
  
  # to 127.0.0.1 by default and is started on boot. Default username is "postgres" with no password
# Create a DB as part of before script to use it
# Make folders for the reports, and create the SQL db
before_script:
  - mkdir -p shippable/testresults
  - mkdir -p shippable/codecoverage
  - mkdir -p shippable/src
  - psql -c 'CREATE DATABASE app_test;' -U postgres

script:
  - npm test
  - echo $beta
  - echo $foo
#addons:
 # postgresql: 9.3

# Generate coverage report with istanbul
after_script:
#  - psql -c 'create database if not exists test;' -U postgres
  - ./node_modules/.bin/istanbul cover ./node_modules/.bin/_mocha -- --ui=bdd --reporter=xunit-file
  - ./node_modules/.bin/istanbul report cobertura --dir shippable/codecoverage/
  

addons:
    postgresql : "9.3"
  

